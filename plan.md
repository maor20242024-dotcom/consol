# ุชูุฑูุฑ ุฌูุณุฉ: ุชุญููู ูู consol.zip/consol/middleware.ts, consol.zip/consol

## ุชูุฑูุฑ ุงูุชุญููู

## ููุฎุต ุชูููุฐู ุณุฑูุน

ููุฏู ูุฐุง ุงูุชุญููู ูุธุฑุฉ ุดุงููุฉ ุนูู ูุดุฑูุน "IMPERIUM GATE"ุ ููู ููุตุฉ ูููุฉ ูุฅุฏุงุฑุฉ ุงูุนูุงุฑุงุช ูุงูุฃุนูุงู ุชุนุชูุฏ ุนูู Next.js 14 ู TypeScript ูุน ุชูุงููุงุช ูุชุนุฏุฏุฉ ููุฐูุงุก ุงูุงุตุทูุงุนู ููุณุงุฆู ุงูุชูุงุตู ุงูุงุฌุชูุงุนู. ููุธูุฑ ุงููุดุฑูุน ุจููุฉ ูููุฉุ ูููุงุฑุณุงุช ุชุทููุฑ ุฌูุฏุฉุ ูุชุฑููุฒุงู ูุงุถุญุงู ุนูู ุชุฌุฑุจุฉ ุงููุทูุฑ (DX) ูู ุฎูุงู ุงููุซุงุฆู ุงูุดุงููุฉ ูุงูุณูุฑุจุชุงุช ุงููุณุงุนุฏุฉ.

ุชุชูุซู ููุงุท ุงูููุฉ ุงูุฑุฆูุณูุฉ ูู ุงูุชูููุฐ ุงููุนูุฏ ูุชูุงููุงุช Meta (Instagramุ WhatsAppุ Facebook Ads) ู Zadarma (VoIP)ุ ุจุงูุฅุถุงูุฉ ุฅูู ุทุจูุฉ ุชุฌุฑูุฏ ูููุฉ ููููุฑู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุชุชูุญ ุงููุฑููุฉ. ููุง ุฃู ุฅุฏุงุฑุฉ ุงูุชุฏููู (i18n) ูุงูููููุงุช ุงููุดุชุฑูุฉ ูููุงุฌูุฉ ุงูุฃูุงููุฉ ูุตููุฉ ุจุดูู ุฌูุฏ.

ููุน ุฐููุ ุชูุฌุฏ ุจุนุถ ุงููุฌุงูุงุช ุงูุชู ุชุชุทูุจ ุงูุชุญุณููุ ุฃุจุฑุฒูุง ูุฌูุฏ ุงุฒุฏูุงุฌูุฉ ูู ูุนุงูุฌุฉ ุงูู Webhooks ูู Metaุ ูุชูุงูุถุงุช ุจุณูุทุฉ ูู ุชุทุจูู ูุตุงุฏูุฉ ุงููุณุชุฎุฏู ูุงูุชุญูู ูู ุตูุงุญูุฉ ุงููุตูู ูู ุจุนุถ ููุงุท ุงูู APIุ ูุญุงุฌุฉ ุฅูู ูุนุงูุฌุฉ ุงูู Access Tokens ุงููุดูุฑุฉ ุจูุถูุญ ุนูุฏ ุงูุงุณุชุฎุฏุงู. ููุตู ุจูุนุงูุฌุฉ ูุฐู ุงููุดููุงุช ูุชุนุฒูุฒ ุฃูุงู ุงูููุฏุ ูุชูููู ุงูุชุนููุฏุ ูุชุญุณูู ูุงุจููุฉ ุงูุตูุงูุฉ ุนูู ุงููุฏู ุงูุทููู.

## ๐ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุฌูุณุฉ

ุชู ุชูุฏูู ูุฌููุนุฉ ูู ูููุงุช ุงูููุฏ ููุดุฑูุน "IMPERIUM GATE". ุชุชุถูู ูุฐู ุงููููุงุช:
*   ูููุงุช ุงูุฅุนุฏุงุฏ ูุงูุชูููู (ูุซู `middleware.ts`, `tailwind.config.ts`, `package.json`, `tsconfig.json`).
*   ูุซุงุฆู ูุงูุฉ (ูุซู `VALIDATION.md`, `DEV_INSTRUCTIONS.md`).
*   ููุงุฐุฌ ุงูุจูุงูุงุช (ูุซู `src/types/crm.ts`, `prisma/seed.ts`).
*   ูููุงุช ุงูุฃุฏูุงุช ูุงูููุชุจุงุช (ูุซู `src/lib/*` ุงูุชู ุชุบุทู ุงููุตุงุฏูุฉุ ูุชูุงููุงุช Meta ู Zadarma ู Google Sheetsุ ูุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ูุชุณุฌูู ุงูุฏุฎูู).
*   ููููุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (ูุซู `src/components/*` ุงูุชู ุชุชุถูู ููููุงุช UI Shadcnุ ูููููุงุช ุฎุงุตุฉ ุจุงูููุฒุงุช ูุซู CRM ู Instagram).
*   ุตูุญุงุช ุงูุชุทุจูู (ูุซู `src/app/[locale]/*` ูู Dashboardุ CRMุ AI Assistantุ Analyticsุ Settingsุ Loginุ Voice).
*   ููุงุท ููุงูุฉ ุงูู API (ูุซู `src/app/api/*` ููู Leadsุ Inboxุ Healthุ AI auto-repliesุ Voiceุ Campaignsุ ู Webhooks).

ูุบุทู ุงููุทุงู ุงูุนุงู ูููุดุฑูุน ุชุทุจูู Next.js 14 ุจุงุณุชุฎุฏุงู App Routerุ ููุชููุฒ ุจุฏุนู TypeScriptุ ููุงุนุฏุฉ ุจูุงูุงุช PostgreSQL ูุน Prismaุ ููุงุฌูุฉ ูุณุชุฎุฏู ูุตููุฉ ุจุงุณุชุฎุฏุงู Tailwind CSS ู Shadcn UI. ูุฑูุฒ ุงููุดุฑูุน ุนูู ุฅุฏุงุฑุฉ ุนูุงูุงุช ุงูุนููุงุก (CRM)ุ ูุฅุฏุงุฑุฉ ุงูุญููุงุช ุงูุฅุนูุงููุฉ (Meta Ads)ุ ููุณุงุนุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ูุชูุงูู ุงููุฑุงุณูุฉ ุงูููุญุฏุฉ (Instagram DM ู WhatsApp)ุ ููุฏุฑุงุช ุงูุงุชุตุงู ุงูุตูุชู (VoIP).

## โ๏ธ ุงููุถุน ุงูุญุงูู

ุงููุดุฑูุน ูู ุญุงูุฉ ูุชูุฏูุฉ ููุงุถุญุฉ ุงููุนุงูู. ูุชููุฒ ุจู:

1.  **ุจููุฉ ูููุฉ ูููุญุฏูุซุฉ**: ูุนุชูุฏ ุนูู Next.js 14 ูุน App Routerุ ููุง ูุฏู ุนูู ุงุณุชุฎุฏุงู ุฃุญุฏุซ ุชูููุงุช ุงูููุจ ููุณุชููุฏ ูู Server Components ู Server Actions.
2.  **ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุนุฏุฏ ุงููููุฑูู**: ููุฌุฏ ุชุฌุฑูุฏ ููุชุงุฒ ููููุฑู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (`src/lib/ai/provider.ts` ู `src/lib/ai-assistant.ts`)ุ ููุง ูุณูุญ ุจุงูุชุจุฏูู ุจูู OpenRouter ู ZAI ู Gemini. ูุฐุง ูููุฑ ูุฑููุฉ ูุจูุฑุฉ ููููู ูู ุงูุงุฑุชุจุงุท ุจูููุฑ ูุงุญุฏ.
3.  **ุชูุงููุงุช ุบููุฉ**: ูุชูุงูู ุงููุดุฑูุน ูุน Meta API (ูู Instagram ู WhatsApp ูุฅุนูุงูุงุช Facebook)ุ ู Zadarma (ูุฎุฏูุงุช ุงูุตูุช)ุ ู Google Sheets. ููุฏ ุชู ุชุตููู ูุฐู ุงูุชูุงููุงุช ุจุนูุงูุฉ.
4.  **ุฏุนู ุงูุชุฏููู (i18n)**: ุชู ุชูููุฐู ุจุงุณุชุฎุฏุงู `next-intl` ููุฏุนู ุงููุบุชูู ุงูุฅูุฌููุฒูุฉ ูุงูุนุฑุจูุฉ ุจุดูู ุฌูุฏุ ุจูุง ูู ุฐูู ุงูุชุจุฏูู ุงูุชููุงุฆู ูุงุชุฌุงู ุงููุต (RTL/LTR).
5.  **ุชุฌุฑุจุฉ ูุทูุฑ ููุชุงุฒุฉ (DX)**: ุชููุฑ ูููุงุช ูุซู `DEV_INSTRUCTIONS.md` ู `VALIDATION.md` ุชูุซููุงู ูุงุถุญุงู ุฌุฏุงู ูุนูููุฉ ุงูุฅุนุฏุงุฏ ูุงูุจููุฉุ ููุง ุชููุฑ ุงูุณูุฑุจุชุงุช ุงููุณุงุนุฏุฉ (`scripts/`) ุฃุฏูุงุช ูููุฉ ูุชุณููู ุงูุชุทููุฑ ูุงูุงุฎุชุจุงุฑุ ุฎุงุตุฉ ูุชูุงูู ุงูู Webhooks ุจุงุณุชุฎุฏุงู Ngrok.
6.  **ุชุตููู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ**: ุงุณุชุฎุฏุงู Tailwind CSS ู Shadcn UIุ ุฅูู ุฌุงูุจ ุชุนุฑูู ูุชุบูุฑุงุช CSS ูุฎุตุตุฉ (`globals.css` ู `tailwind.config.ts`)ุ ูุถูู ูุงุฌูุฉ ูุณุชุฎุฏู ูุชุณูุฉ ูุฌุฐุงุจุฉ ุจุตุฑูุงู ูุน ูููุฉ ุจุตุฑูุฉ ูููุฉ (ููุญุฉ ุงูุฃููุงู ุงูุฐูุจูุฉ ุงูููููุฉ).
7.  **ุงููุตุงุฏูุฉ ูุงูุชุฎููู**: ูุชู ุงุณุชุฎุฏุงู Supabase ูููุตุงุฏูุฉุ ู `middleware.ts` ููุทุจูู ุญูุงูุฉ ุงููุณุงุฑุงุช ูุงูุชุญูู ูู ุงูุฃุฏูุงุฑ (admin/user) ุจุดูู ูุนุงู.
8.  **ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุนููุงุก (CRM)**: ุชู ุชุตููู ูุธุงู CRM ุจุดูู ุฌูุฏุ ููุฏุนู ุนุฑุถ Kanban ู Listุ ููุญุชูู ุนูู ููุงุชุฑ ูููุฉุ ูุฅุฏุงุฑุฉ ุงูุฃูุดุทุฉุ ูุชุญููู ุงูุฑุณุงุฆู ุฅูู Leads.
9.  **ูุธุงู ุงูุชุณุฌูู ุงูุดุงูู**: ูุชููุฒ ุจูุฌูุฏ ุฃุฏุงุฉ ุชุณุฌูู ูุฎุตุตุฉ (`src/lib/logger.ts`) ุชุณุงุนุฏ ูู ุชุชุจุน ุงูุฃุญุฏุงุซ ูุงูุฃุฎุทุงุกุ ููู ูููุฏุฉ ุฌุฏุงู ูุชุตุญูุญ ุงูุฃุฎุทุงุก ููุฑุงูุจุฉ ุงูู Webhooks.

ุจุดูู ุนุงูุ ุงููุดุฑูุน ููุธู ุจุดูู ุฌูุฏุ ูููุธูุฑ ุงูุชุฒุงูุงู ุจุงูุฌูุฏุฉ ููุงุจููุฉ ุงูุชูุณุน.

## ๐จ ุงูุฃุฎุทุงุก ูุงููุดุงูู

1.  **ุงุฒุฏูุงุฌูุฉ ูุนุงูุฌ ุงูู Webhook ุงูุฎุงุต ุจู Instagram**:
    *   **ุงููุดููุฉ**: ููุฌุฏ ูููุงู ููุนุงูุฌุฉ Webhooks ุงูุฎุงุตุฉ ุจู Instagram:
        *   `src/app/api/webhooks/meta/route.ts` (ุงููุนุงูุฌ ุงูููุญุฏ ูู Instagram ู WhatsApp).
        *   `src/app/api/webhooks/instagram/messages/route.ts` (ูุนุงูุฌ ูุฏูู/ููุฑุฑ ุฎุงุต ุจู Instagram).
        ูุญุชูู ููุง ุงูููููู ุนูู ููุทู ุชุญูู ูุชุฎุฒูู ููุฑุณุงุฆูุ ููุง ูุฏ ูุคุฏู ุฅูู ุณููู ุบูุฑ ูุชููุนุ ุฃู ุชุฎุฒูู ููุฑุฑ ููุจูุงูุงุชุ ุฃู ุตุนูุจุฉ ูู ุงูุตูุงูุฉ. ููุธูุฑ `meta/route.ts` ุฃูู ุงูุฃูุซุฑ ุญุฏุงุซุฉ ูุดูููุงู.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/src/app/api/webhooks/meta/route.ts` ู `consol.zip/consol/src/app/api/webhooks/instagram/messages/route.ts`.

2.  **ุนุฏู ูุนุงูุฌุฉ Access Tokens ุงููุดูุฑุฉ ุนูุฏ ุงูุงุณุชุฎุฏุงู**:
    *   **ุงููุดููุฉ**: ูุชู ุชุฎุฒูู Access Tokens ุงูุฎุงุตุฉ ุจู Meta (Instagram ู WhatsApp) ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ูุดูุฑ (`src/app/api/integrations/instagram/callback/route.ts` ุณุทุฑ 96 ูุณุชุฎุฏู `encrypt(accessToken)`). ููุน ุฐููุ ุนูุฏ ุงุณุชุฑุฌุงุนูุง ูุงุณุชุฎุฏุงููุง ูู ููุงุท API ุฃุฎุฑู (ูุซู `src/app/api/inbox/route.ts` ุณุทุฑ 125)ุ ูุชู ุงุณุชุฎุฏุงู `userInstagramAccount.accessToken` ูุจุงุดุฑุฉ ุฏูู ุฅูุบุงุก ุชุดููุฑูุง. ูุฐุง ูุนูู ุฃู ุงูุฑูุฒ ุงููููุฒ (Token) ูู ูููู ุตุงูุญุงู ููุงุณุชุฎุฏุงู ูุน Meta API ูุง ูู ูุชู ุฅูุบุงุก ุชุดููุฑู ุตุฑุงุญุฉ.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/src/app/api/inbox/route.ts` (ุณุทุฑ 125), `consol.zip/consol/src/app/api/instagram/posts/route.ts` (ุณุทุฑ 54).

3.  **ุงูุงุณุชุฎุฏุงู ุบูุฑ ุงููุชุณู ูุชููุฆุฉ Prisma Client**:
    *   **ุงููุดููุฉ**: ุนูู ุงูุฑุบู ูู ูุฌูุฏ singleton ูู Prisma Client ูู `src/lib/db.ts` (ููุงุฑุณุฉ ููุชุงุฒุฉ)ุ ูุฅู ุจุนุถ ููุงุท ููุงูุฉ ุงูู API ุชููู ุจุฅูุดุงุก ูุซูู ุฌุฏูุฏ ูู `PrismaClient` ูู ูู ุทูุจ:
        *   `new PrismaClient()` ูู `src/app/api/campaigns-manager/route.ts` (ุณุทุฑ 32ุ 65ุ 109).
        *   `new PrismaClient()` ูู `src/app/api/ai-assistant/save-conversation/route.ts` (ุณุทุฑ 55).
    *   **ุงูุชุฃุซูุฑ**: ูุคุฏู ูุฐุง ุฅูู ุฅูุดุงุก ุงุชุตุงูุงุช ูุชุนุฏุฏุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ููู ุทูุจุ ููุง ูุณุชููู ููุงุฑุฏ ุฃูุซุฑ ููููู ุงูููุงุกุฉ.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/src/app/api/campaigns-manager/route.ts`, `consol.zip/consol/src/app/api/ai-assistant/save-conversation/route.ts`.

4.  **ุงูููู ุงูุซุงุจุชุฉ (Hardcoded Values) ูู Verify Token**:
    *   **ุงููุดููุฉ**: ูุชู ุงุณุชุฎุฏุงู ูููุฉ `imperiumgate_meta_verify_2024` ูุจุงุดุฑุฉ ูู `middleware.ts` (ุณุทุฑ 26) ู `scripts/setup-ngrok-webhook.ts` (ุณุทุฑ 164) ููุชุญูู ูู ุงูู Webhook. ูุฌุจ ุฃู ูุชู ุงุณุชุฑุฏุงุฏ ูุฐู ุงููููุฉ ูู ูุชุบูุฑ ุงูุจูุฆุฉ (`env.META_WEBHOOK_VERIFY_TOKEN`) ูุถูุงู ุงููุฑููุฉ ูุงูุฃูุงู.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/middleware.ts` (ุณุทุฑ 26), `consol.zip/consol/src/app/api/webhooks/meta/route.ts` (ุณุทุฑ 24), `consol.zip/consol/scripts/setup-ngrok-webhook.ts` (ุณุทุฑ 164).

5.  **ุนุฏู ุงูุชูุงูู ูู ููุชุจุฉ Toast**:
    *   **ุงููุดููุฉ**: ูุจุฏู ุฃู ุงููุดุฑูุน ูุณุชุฎุฏู ููุชุจุชูู ูุฎุชููุชูู ููู toasts: `react-hot-toast` (ูู ุฎูุงู `src/hooks/use-toast.ts` ู `src/components/ui/toaster.tsx`) ู `sonner` (ูู ุฎูุงู `src/components/ui/sonner.tsx`). ูุฐุง ูููู ุฃู ูุคุฏู ุฅูู ุชุถุฎู ุญุฌู ุงูุจุงูุฉุ ูุนุฏู ุงุชุณุงู ูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏูุ ูุชุนููุฏ ุบูุฑ ุถุฑูุฑู.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/src/components/ui/toaster.tsx` (ูุณุชุฎุฏู `useToast` ู `Toast`), `consol.zip/consol/src/components/ui/sonner.tsx` (ูุณุชุฎุฏู `sonner`).

6.  **ุชุฌุงูุฒ ุทุจูุฉ ุชุฌุฑูุฏ AI Provider ูู ุจุนุถ ุงูุฃูุงูู**:
    *   **ุงููุดููุฉ**: ุนูู ุงูุฑุบู ูู ูุฌูุฏ ุทุจูุฉ ุชุฌุฑูุฏ ููุชุงุฒุฉ ููููุฑู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู `src/lib/ai/provider.ts`ุ ูุฅู `src/app/api/campaigns-manager/ai-suggestions/route.ts` ูุนูุฏ ุชูููุฐ ููุทู ุงูุชุจุฏูู ุจูู ุงููููุฑูู (OpenRouter, ZAI, Gemini) ูุฏููุงู. ูุฐุง ูุฎุงูู ูุจุฏุฃ DRY (Don't Repeat Yourself) ููุฌุนู ุชุญุฏูุซ ููุทู AI ุฃูุซุฑ ุตุนูุจุฉ.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/src/app/api/campaigns-manager/ai-suggestions/route.ts` (ุณุทุฑ 40-97).

7.  **ููู ุงูุชุฑุงุถูุฉ hardcoded ูู AI Persona**:
    *   **ุงููุดููุฉ**: ููู `src/app/api/ai-agent/route.ts` (ุณุทุฑ 6) ูุญุชูู ุนูู `IMPERIUM_AI_PERSONA` ูุชุถูู ูุนูููุงุช ููุดุงุฑูุน ุนูุงุฑูุฉ hardcoded. ุจูููุง ูููู ุฃู ุชููู ูุฐู ุงูุชูุงุตูู ุฌุฒุกุงู ูู Personaุ ูุฅู ุฌุนููุง ูููุง ููููุง ุซุงุจุชุฉ ูููู ูู ูุฑููุฉ ุงูุชููููุ ุฎุงุตุฉ ุฅุฐุง ูุงู ูู ุงูููุชุฑุถ ุฃู ุชุชุบูุฑ ูุฐู ุงูุชูุงุตูู.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/src/app/api/ai-agent/route.ts` (ุณุทุฑ 6).

8.  **ุงุณุชุฎุฏุงู `window.location.reload()` ูู `LeadDetailsDialog`**:
    *   **ุงููุดููุฉ**: ุนูุฏ ุชุญุฏูุซ Lead ูู `src/components/crm/lead-details-dialog.tsx` (ุณุทุฑ 82)ุ ูุชู ุงุณุชุฎุฏุงู `window.location.reload()` ูุชุญุฏูุซ ุงูุจูุงูุงุช. ูุฐู ุทุฑููุฉ ุบูุฑ ูุนุงูุฉ ูุชุคุฏู ุฅูู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุจุงููุงููุ ููุง ููุทุน ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู.
    *   **ุงูุชุฃุซูุฑ**: ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉุ ุงุณุชููุงู ุบูุฑ ุถุฑูุฑู ููููุงุฑุฏ.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/src/components/crm/lead-details-dialog.tsx` (ุณุทุฑ 82).

9.  **ูุดุงูู ูุญุชููุฉ ูู ุฃุฏุงุก `unified-inbox.tsx`**:
    *   **ุงููุดููุฉ**: `loadMessages` ูู `src/components/inbox/unified-inbox.tsx` ูููู ุจุฌูุจ 50 ุฑุณุงูุฉ (Instagram + WhatsApp) ูู ุงูู backend ูู ูู ูุฑุฉ (ูู 15 ุซุงููุฉ). ุซู ูุชู ุฅูุดุงุก ุงููุญุงุฏุซุงุช ูุงูุฑุณุงุฆู ูุชุตููุชูุง ูู ุงูู frontend. ูู ูุธุงู ุจุฅูุชุงุฌ ุนุงูู ูู ุงูุฑุณุงุฆูุ ูููู ุฃู ูุตุจุญ ูุฐุง ุบูุฑ ูุนุงู ููุคุฏู ุฅูู ูุดุงูู ูู ุงูุฃุฏุงุก ุนูู ุงูุนููู.
    *   **ุงููุฑุฌุน**: `consol.zip/consol/src/components/inbox/unified-inbox.tsx` (ุณุทุฑ 52ุ 102).

## ๐งญ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

1.  **ุชูุญูุฏ ูุนุงูุฌุงุช ุงูู Webhook ุงูุฎุงุตุฉ ุจู Meta**:
    *   **ุงูุฃููููุฉ**: โก๏ธุนุงููุฉ ุฌุฏุงู
    *   **ุงูุฅุฌุฑุงุก**: ูู ุจุฅุฒุงูุฉ ุฃู ุฏูุฌ `src/app/api/webhooks/instagram/messages/route.ts` ูู `src/app/api/webhooks/meta/route.ts`. ุชุฃูุฏ ูู ุฃู ุงููุนุงูุฌ ุงูููุญุฏ ูุชุนุงูู ูุน ุฌููุน ุฃููุงุน ุงูู Webhooks ูู Meta (Instagram ู WhatsApp ู Facebook Ads) ุจุดูู ุตุญูุญ ููุนุงูุ ูุฃู ููุทู ุงูุชุญูู ูู ุงูุชูููุน ูุชุฎุฒูู ุงูุฑุณุงุฆู ููุนุงูุฌุฉ ุงูุฑุฏูุฏ ุงูุชููุงุฆูุฉ ูุชู ูุฑุฉ ูุงุญุฏุฉ ููุท.

2.  **ูุนุงูุฌุฉ Access Tokens ุงููุดูุฑุฉ ุจุดูู ุตุญูุญ**:
    *   **ุงูุฃููููุฉ**: โก๏ธุนุงููุฉ
    *   **ุงูุฅุฌุฑุงุก**: ูู ุฃู ููุงู ูุชู ููู ุงุณุชุฑุฌุงุน `accessToken` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุณุชุฎุฏุงูู ูุน Meta API (ูุซู `src/app/api/inbox/route.ts` ู `src/app/api/instagram/posts/route.ts`)ุ ูุฌุจ ุฅูุบุงุก ุชุดููุฑู ุจุงุณุชุฎุฏุงู ุฏุงูุฉ `decrypt` ูู `src/lib/encryption.ts` ูุจู ุชูุฑูุฑู ุฅูู `meta-client`.
    *   **ูุซุงู**:
        ```typescript
        import { decrypt } from '@/lib/encryption';
        // ...
        const decryptedAccessToken = decrypt(userInstagramAccount.accessToken);
        // ุซู ุงุณุชุฎุฏู decryptedAccessToken ูุน sendInstagramMessage
        ```

3.  **ุชูุญูุฏ ุงุณุชุฎุฏุงู Prisma Client Singleton**:
    *   **ุงูุฃููููุฉ**: โก๏ธูุชูุณุทุฉ
    *   **ุงูุฅุฌุฑุงุก**: ูู ุจุชุนุฏูู ูููุงุช ูุซู `src/app/api/campaigns-manager/route.ts` ู `src/app/api/ai-assistant/save-conversation/route.ts` ูุงุณุชุฎุฏุงู ูุซูู Prisma Client ุงููุตุฏุฑ ูู `src/lib/db.ts`.
    *   **ูุซุงู**: ุจุฏูุงู ูู `const prisma = new PrismaClient();`ุ ุงุณุชุฎุฏู `import { prisma } from '@/lib/db';`.

4.  **ุชูุญูุฏ ููุชุจุงุช Toast**:
    *   **ุงูุฃููููุฉ**: โก๏ธูุชูุณุทุฉ
    *   **ุงูุฅุฌุฑุงุก**: ุงุฎุชุฑ ููุชุจุฉ ูุงุญุฏุฉ ููู toasts (ุฅูุง `react-hot-toast` ุฃู `sonner`) ููู ุจุฅุฒุงูุฉ ุงูุฃุฎุฑู ุจุงููุงูู ูู ุงููุดุฑูุน ูุชูููู ุงูุชุจุนูุงุช ูุชุญุณูู ุงูุงุชุณุงู.

5.  **ุชุญุณูู ุฅุฏุงุฑุฉ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุงูุญุณุงุณุฉ**:
    *   **ุงูุฃููููุฉ**: โก๏ธูุชูุณุทุฉ
    *   **ุงูุฅุฌุฑุงุก**:
        *   ุงุณุชุฎุฏู `env.META_WEBHOOK_VERIFY_TOKEN` ุจุฏูุงู ูู ุงููููุฉ ุงูุซุงุจุชุฉ ูู `middleware.ts` ู `scripts/setup-ngrok-webhook.ts` ูุถูุงู ุงูุงุชุณุงู ูุงูุฃูุงู.
        *   ุงุฌุนู ุงูุฃุฌุฒุงุก ุงููุงุจูุฉ ููุชูููู ูู `IMPERIUM_AI_PERSONA` (ูุซู ุฃุณูุงุก ุงููุดุงุฑูุนุ ุงูููู ุงูุงูุชุฑุงุถูุฉ) ูุงุจูุฉ ููุชูููู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุฃู ูู ูููุงุช ุชููุฆุฉ ูููุตูุฉุ ุจุฏูุงู ูู ุชุถููููุง ูู ุงูููุฏ ุงููุตุฏุฑ.

6.  **ูุฑูุฒูุฉ ุงุณุชุฎุฏุงู ูุธุงุฆู ุงูุฐูุงุก ุงูุงุตุทูุงุนู**:
    *   **ุงูุฃููููุฉ**: โก๏ธูุชูุณุทุฉ
    *   **ุงูุฅุฌุฑุงุก**: ุชุฃูุฏ ูู ุฃู ุฌููุน ููุงุท ููุงูุฉ ุงูู API ุงูุชู ุชุญุชุงุฌ ุฅูู ุชูููุฏ ูุตูุต ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู (ูุซู `src/app/api/campaigns-manager/ai-suggestions/route.ts`) ุชุณุชุฎุฏู ุฏุงูุฉ `generateText` ูู `src/lib/ai/provider.ts` ูุจุงุดุฑุฉ ุจุฏูุงู ูู ุชูุฑุงุฑ ููุทู ุงุฎุชูุงุฑ ุงููููุฑ.

7.  **ุชุญุณูู ุฃุฏุงุก `UnifiedInbox`**:
    *   **ุงูุฃููููุฉ**: โก๏ธูุชูุณุทุฉ
    *   **ุงูุฅุฌุฑุงุก**:
        *   ูู ุจุชุญุณูู ููุทุฉ ููุงูุฉ `GET /api/inbox` ููุณูุงุญ ุจุชุตููุฉ ุงูุฑุณุงุฆู ุญุณุจ `conversationId` ุฃู `contactHandle`ุ ุจุฏูุงู ูู ุฌูุจ ุฌููุน ุงูุฑุณุงุฆู ุซู ุชุตููุชูุง ุนูู ุงูุนููู.
        *   ุงุณุชุฎุฏู ุชูููุงุช ูุซู pagination ุฃู infinite scrolling ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุชุญููู ุงูุฑุณุงุฆู ุจุดูู ุชุฏุฑูุฌู ุจุฏูุงู ูู ุฌูุจ 50 ุฑุณุงูุฉ ูู 15 ุซุงููุฉุ ููุง ูุญุณู ุงูุฃุฏุงุก ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุจุดูู ูุจูุฑ.

8.  **ุฅุฒุงูุฉ `window.location.reload()` ูู `LeadDetailsDialog`**:
    *   **ุงูุฃููููุฉ**: โก๏ธููุฎูุถุฉ
    *   **ุงูุฅุฌุฑุงุก**: ุจุฏูุงู ูู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉุ ุงุณุชุฎุฏู `revalidatePath` ุฃู ุฏุงูุฉ ุฑุฏ ูุฏุงุก (callback) ูู ุงููููู ุงูุฃุจ ูุชุญุฏูุซ ูุงุฆูุฉ Leads ุฃู Lead ุงููุญุฏุฏุ ูุชูุฏูู ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ.

9.  **ูุฑุงุฌุนุฉ ููุทุฉ ููุงูุฉ `src/app/api/users/route.ts`**:
    *   **ุงูุฃููููุฉ**: โก๏ธููุฎูุถุฉ
    *   **ุงูุฅุฌุฑุงุก**: ุญุฏุฏ ูุง ุฅุฐุง ูุงูุช ููุทุฉ ุงูููุงูุฉ ูุฐู ูุง ุชุฒุงู ุถุฑูุฑูุฉ. ุฅุฐุง ูุงูุช ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุชุชู ุจุงููุงูู ุนุจุฑ Supabase Authุ ููุฏ ุชููู ูุฐู ุงูููุทุฉ ุฒุงุฆุฏุฉ ุนู ุงูุญุงุฌุฉ ููููู ุฅุฒุงูุชูุง ูุชูููู ุณุทุญ ุงููุฌูู.

## ๐ก ุชุญุณูู ุฃุณููุจ ุงูุชูุฌูู (Prompt Engineering)

ูุงู ุงูุชูุฌูู ููุณูุงู ุจุดูู ุฌูุฏ (Provided Files) ููุจุงุดุฑุงู (Analysis Task, structure), ููุง ุฃุฏู ุฅูู ุชุญููู ูุนุงู ูุดุงูู. ูุง ุชูุฌุฏ ุงูุชุฑุงุญุงุช ููุฑูุฉ ูุชุญุณููู.

## ๐ ุชุญููู ุงููููุงุช

### `consol.zip/consol/middleware.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 26**: ุงุณุชุฎุฏุงู ูููุฉ ุซุงุจุชุฉ (`'imperiumgate_meta_verify_2024'`) ูู `META_WEBHOOK_VERIFY_TOKEN`. ูุฌุจ ุงุณุชุฎุฏุงู `env.META_WEBHOOK_VERIFY_TOKEN` ูุถูุงู ุงููุฑููุฉ ูุงูุงุชุณุงู ูุน ูุชุบูุฑุงุช ุงูุจูุฆุฉ.
*   **ุงูุชุญุณููุงุช**:
    *   **ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงูู Locale**: ูููู ุชุจุณูุท ููุทู ุงุณุชุฎุฑุงุฌ ุงูู locale ูุงููุณุงุฑ ุจุฏูู locale ุจุงุณุชุฎุฏุงู ุฏูุงู ูุณุงุนุฏุฉ ูู `next-intl/routing` ุฃู ููุชุจุฉ ุฃุฎุฑู ุฅุฐุง ูุงูุช ูุชููุฑุฉ ุจุฏูุงู ูู `pathname.match`.
    *   **ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก**: ููุธูุฑ `catch (error: any)` ูู ุณุทุฑ 74 ููุน `any`ุ ูููู ุชุญุณูู ุฐูู ุจุชุญุฏูุฏ ุฃููุงุน ุงูุฃุฎุทุงุก ุจุดูู ุฃูุซุฑ ุฏูุฉ ุฅู ุฃููู.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุชุทุจูู ููู ูููุตุงุฏูุฉ ูุงูุชุฎููู ูููุณุงุฑุงุช ุงููุญููุฉ.
    *   ุชุถููู ูุนูููุงุช ุงููุณุชุฎุฏู ูู ุงูู headers ุงูุฎุงุตุฉ ุจุงูุงุณุชุฌุงุจุฉ (`X-User-Id`, `X-User-Email`, `X-User-Role`) ูููุฏ ููุชุชุจุน ูุงูุชุฏููู.
    *   ุชุทุจูู `next-intl/middleware` ููุชุฏููู ููุนุฏ ููุงุฑุณุฉ ุฌูุฏุฉ.
    *   ุชุถููู ุนูุงููู ุฃูุงู ูุทูุจุงุช ุงูู webhook ุงูุนุงูุฉ (`X-Content-Type-Options`, `X-Frame-Options`, `X-XSS-Protection`) ูุนุฒุฒ ุงูุฃูุงู.

### `consol.zip/consol/VALIDATION.md`
*   **ุงูุชุญุณููุงุช**:
    *   ูุซููุฉ ููุชุงุฒุฉ ุชููุฏู ูุธุฑุฉ ุนุงูุฉ ูุงุถุญุฉ ุนูู ุนูููุฉ ุงูุชูุธูู ูุญุงูุฉ ุงููุดุฑูุน. ูููู ุฃู ุชููู ุจูุซุงุจุฉ ูุงูุจ ุฌูุฏ ููุซุงุฆู ุงููุดุงุฑูุน ุงูุฃุฎุฑู.

### `consol.zip/consol/tailwind.config.ts`
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุงุณุชุฎุฏุงู ูุชุบูุฑุงุช CSS (HSLs) ููุชุตููู ูููุฑ ูุฑููุฉ ูุจูุฑุฉ ููู theming (Dark/Light mode).
    *   ุชุนุฑูู ุฃููุงู ูุฎุตุตุฉ ูููุญุฉ "Royal Palette" ูุนูุณ ูููุฉ ุจุตุฑูุฉ ูููุฉ.
    *   ุชุนุฑูู animations ูุฎุตุตุฉ ูุนุฒุฒ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุงูุจุตุฑูุฉ.

### `consol.zip/consol/package.json`
*   **ุงูุชุญุณููุงุช**:
    *   ููุฌุฏ ุงุณุชุฎุฏุงู ูููุชุจุชู toasts: `@radix-ui/react-toast` ู `sonner`. ููุถู ุชูุญูุฏ ุงูุงุณุชุฎุฏุงู ูููุชุจุฉ ูุงุญุฏุฉ ูุชูููู ุญุฌู ุงูุจุงูุฉ (bundle size) ูุงูุงุชุณุงู.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ูุฌูุฏ ุณูุฑุจุชุงุช `db:*` ู `validate:*` ูููุฏ ุฌุฏุงู ูุฃุชูุชุฉ ููุงู ุงูุชุทููุฑ ูุงูุตูุงูุฉ ูุงูุชุญูู.
    *   ุงุณุชุฎุฏุงู `tsx` ูุณูุฑุจุชุงุช Node.js ููุณููู ูุชุงุจุฉ ุงูุณูุฑุจุชุงุช ุจู TypeScript.

### `consol.zip/consol/DEV_INSTRUCTIONS.md`
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ูุซููุฉ ุชูุฌููุงุช ููุชุงุฒุฉ ูููุทูุฑูู ุงูุฌุฏุฏุ ุชูุนุชุจุฑ "SINGLE SOURCE OF TRUTH". ุชุบุทู ูู ุฌุงูุจ ูู ุฌูุงูุจ ุงููุดุฑูุนุ ูู ุงููุธุฑุฉ ุงูุนุงูุฉ ุฅูู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ูุฅุตูุงุญูุง. ูุฐุง ูููู ุจุดูู ูุจูุฑ ูู ููุญูู ุงูุชุนูู.

### `consol.zip/consol/scripts/setup-ngrok-webhook.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 164**: ุงููููุฉ ุงูุซุงุจุชุฉ (`imperiumgate_meta_verify_2024`) ูู `VERIFY TOKEN`. ูุฌุจ ุฃู ุชุณุชุฎุฏู ูุชุบูุฑ ุงูุจูุฆุฉ `process.env.META_WEBHOOK_VERIFY_TOKEN`.
*   **ุงูุชุญุณููุงุช**:
    *   ููุนุฏ ุงูุณูุฑุจุช ููุณู ููุงุฑุณุฉ ุฌูุฏุฉ ูุชุณููู ุฅุนุฏุงุฏ ุงูู webhooks ูุญููุงู.

### `consol.zip/consol/src/lib/api-auth.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 32**: ูู ูุถุน ุงูุชุทููุฑุ ููุฑุฌุน ูุณุชุฎุฏู ูููู (`dev-user-id`). ูุฐุง ูููุฏ ููุชุทููุฑุ ูููู ูุฌุจ ุงูุชุฃูุฏ ูู ุนุฏู ุชุณุฑุจู ุฅูู ุจูุฆุฉ ุงูุฅูุชุงุฌ ูุฃู ุงููุญุต ุงูุฃููู ูู `middleware.ts` ูุงูู.
    *   **ุณุทุฑ 71-72**: ุงูุชุญูู ูู ุฏูุฑ ุงููุณุคูู ูุนุชูุฏ ุนูู ุชุถููู `admin` ุฃู `imperiumgate` ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู. ูุฐุง ููุณ ููุฌุงู ูููุงู ูุชุญุฏูุฏ ุงูุฃุฏูุงุฑุ ูุฌุจ ุงุณุชุฎุฏุงู ุงูุฏูุฑ ุงููุฎุฒู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (`authUser.role`). (ุชูุช ูุนุงูุฌุฉ ุฐูู ุฌุฒุฆูุงู ูู `middleware.ts` ุณุทุฑ 68ุ ููู `requireAdminAuth` ุงููุฏููุฉ ูุง ุชุฒุงู ุชุณุชุฎุฏู ููุทู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู).
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุงุณุชุฎุฏุงู `createServerClient` ูุน `cookies()` ููุญุตูู ุนูู ุฌูุณุฉ ุงููุณุชุฎุฏู ูู ุงูู headers ูุงูู cookies.
    *   ูุญุต ุงูุฏูุฑ ุงููุทููุจ (`options?.requiredRole`) ููุนุฒูุฒ ุฃูุงู ุงููุณุงุฑุงุช.
    *   ุงูุชุนุงูู ูุน ุงููุตูู ุงููุฌููู (`allowAnonymous`) ุจุดูู ูุงุถุญ.

### `consol.zip/consol/src/lib/meta-client.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 115ุ 177**: ูุธููุฉ `sendInstagramMessage` ู `sendWhatsAppMessage` ุชุชููุน `accessToken` ุบูุฑ ูุดูุฑ. ุฅุฐุง ูุงู ุงูู token ูุฎุฒูุงู ูุดูุฑุงูุ ููุฌุจ ุฅูุบุงุก ุชุดููุฑู ูุจู ุชูุฑูุฑู ุฅูู ูุฐู ุงููุธุงุฆู.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ููุทุฉ ูุฑูุฒูุฉ ูุชูุงุนู Meta Graph APIุ ููุง ูุณูู ุงูุตูุงูุฉ ูุงูุชุญุฏูุซุงุช.
    *   ุชุถููู ููุทู ุฅุนุงุฏุฉ ุงููุญุงููุฉ (`retryCount`) ูู `sendInstagramMessage` ูุญุณู ุงูููุซูููุฉ.
    *   ูุธููุฉ `verifyWebhookSignature` ุถุฑูุฑูุฉ ูุฃูุงู ุงูู Webhooks.

### `consol.zip/consol/src/lib/ai-assistant.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 100**: ุงูุชุนููู `@ts-ignore` ูู `SYSTEM_PROMPTS[mode]?.[locale]` ูุดูุฑ ุฅูู ูุดููุฉ ูู Type Safety ูููู ุญููุง ุจุชุนุฑูู ุฃููุงุน ุฃูุซุฑ ุฏูุฉ ูู `SYSTEM_PROMPTS`.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุชุฌุฑูุฏ ููุชุงุฒ ููููุฑู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุน ุฏุนู ุงูุชุฏูู (streaming) ูุงูุชุจุฏูู ุงููุชุณูุณู ุจูู ุงููููุฑูู (`tryProvidersSequentially`). ูุฐุง ุชุตููู ููู ููููุซูููุฉ ูุงููุฑููุฉ.
    *   ุชุนุฑูู `SYSTEM_PROMPTS` ููุฎุชูู ุงูุฃูุถุงุน ูุงููุบุงุช ูุชูุญ ุชุฎุตูุตุงู ุณููุงู.

### `consol.zip/consol/src/lib/encryption.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 6**: ุงุณุชุฎุฏุงู `Buffer.from(rawKey, 'utf8')` ูุฏ ูุณุจุจ ูุดุงูู ุฅุฐุง ูุงู ุงูููุชุงุญ ุบูุฑ ุตุงูุญ (ูุซู ุฃู ูููู ุฃูุตุฑ ูู 32 ุจุงูุช)ุ ููุง ูุคุฏู ุฅูู ูุดู `assertKeyLength()`. ูุฌุจ ุฃู ูููู ุงูููุชุงุญ ุณุฑูุงู ูููุงู ุฐุง 32 ุจุงูุช.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุชุดููุฑ ููู ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ุจุงุณุชุฎุฏุงู AES-256-CBC.
    *   ุงูุชุญูู ูู ุทูู ุงูููุชุงุญ (`assertKeyLength()`) ูุฒูุฏ ูู ุงููุชุงูุฉ.

### `consol.zip/consol/src/lib/db.ts`
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุฅูุดุงุก ูุซูู `PrismaClient` ูู singleton ุนุงููู ูุถูู ุนุฏู ุฅูุดุงุก ุงุชุตุงูุงุช ูุชุนุฏุฏุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุชุ ููุง ูุญุณู ุงูุฃุฏุงุก ููููู ูู ุงุณุชููุงู ุงูููุงุฑุฏ.

### `consol.zip/consol/src/lib/ai/provider.ts`
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุทุจูุฉ ุชุฌุฑูุฏ ูุฑูุฒูุฉ ููููุฑู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (OpenRouter, ZAI, Gemini)ุ ุชุชูุญ ุชุจุฏูู ุงููููุฑูู ุจุณูููุฉ.
    *   ุชุถููู ุขููุฉ Fallback (ุงูุนูุฏุฉ ูู Gemini) ุฅุฐุง ูุดู ุงููููุฑ ุงูุฃุณุงุณู ูุนุฒุฒ ุงูููุซูููุฉ.
    *   ุฏูุงู `getCurrentProvider` ู `getProviderStatus` ู `testProvider` ูููุฏุฉ ุฌุฏุงู ููุฅุฏุงุฑุฉ ูุงููุฑุงูุจุฉ.

### `consol.zip/consol/src/app/[locale]/ad-creator/client.tsx`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 131**: ุงุณุชุฎุฏุงู `simulateApiDelay(800)` ููุญุงูุงุฉ ุงูุชุฃุฎูุฑ. ูุฐู ุงููุธููุฉ ูููุฏุฉ ููุชุทููุฑ ูููู ูุฌุจ ุฅุฒุงูุชูุง ูู ุงูุฅูุชุงุฌ ูุนุฏู ุฅุจุทุงุก ุงุณุชุฌุงุจุงุช ุงูู UI.
    *   **ุณุทุฑ 98-100ุ 115-117**: ูุนูุฏ ุชูููุฐ ููุทู ุงุณุชุฏุนุงุก AI (`generateHeadlineSuggestion`, `generateDescriptionSuggestion`) ุจุฏูุงู ูู ุงุณุชุฎุฏุงู ุงูู API routes ุฃู Server Actions ุงููุฎุตุตุฉ ูุฐูู ุจุดูู ูุจุงุดุฑุ ููุง ูุฎุงูู ูุจุฏุฃ ุงูุชุฌุฑูุฏ. `handleAISuggestHeadline` ู `handleAISuggestDescription` ูุฌุจ ุฃู ุชุณุชุฏุนู Server Action ุจุฏูุงู ูู `lib/ai/ad-creator.ts` ูุจุงุดุฑุฉ.
*   **ุงูุชุญุณููุงุช**:
    *   **ุชุญุฏูุฏ ุงูุญููุฉ**: ูู ุณุทุฑ 68ุ ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ `selectedCampaignId` ููุงูุช ููุงู ุญููุงุช ูุชุงุญุฉุ ูุฅูู ูุฎุชุงุฑ ุฃูู ุญููุฉ. ูููู ุชุญุณูู ูุฐุง ุงูููุทู ููุชูุงุณุจ ูุน ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (ูุซูุงูุ ุญูุธ ุขุฎุฑ ุญููุฉ ุชู ุงุณุชุฎุฏุงููุง).
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุชุตููู ุฌูุฏ ููุงุฌูุฉ ูุณุชุฎุฏู ุฅูุดุงุก ุงูุฅุนูุงูุงุช ูุน ุนูุงูุงุช ุชุจููุจ ูููุทู ุชุญููู/ุชูุจูู.

### `consol.zip/consol/src/app/[locale]/crm/page.tsx`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 82**: `window.location.reload()` ุชูุณุชุฎุฏู ุจุนุฏ ุชุญุฏูุซ Lead ูู `LeadDetailsDialog`. ูุฐุง ูุคุฏู ุฅูู ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ (ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุจุฃููููุง). ูุฌุจ ุงุณุชุจุฏุงููุง ุจุขููุฉ ุชุญุฏูุซ ุญุงูุฉ ุฃูุซุฑ ุฏูุฉ.
*   **ุงูุชุญุณููุงุช**:
    *   ุงุณุชุฎุฏุงู `PageShell` ู `FloatingDots` ู Tabs ูุนุฒุฒ ุงูุงุชุณุงู ุงูุจุตุฑู ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู.
    *   ุงูุชุญููู ุงูุฏููุงูููู ูู `FloatingDots` ูููู ูู ุญุฌู ุงูู bundle ุงูุฃููู.
    *   ุงุณุชุฎุฏุงู `useCallback` ูู `handleFiltersChange` ููุญุณู ุงูุฃุฏุงุก ุนู ุทุฑูู ููุน ุฅุนุงุฏุฉ ุฅูุดุงุก ุงููุธููุฉ ูู ูู ูุฑุฉ ูุชู ูููุง ุฅุนุงุฏุฉ ุนุฑุถ ุงููููู.

### `consol.zip/consol/src/app/[locale]/admin/page.tsx`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 69**: `supabase.from("profiles").select("*", { count: "exact", head: true });` ูุฌูุจ `usersCount`. ูุง ููุฌุฏ ุฌุฏูู `profiles` ูู `schema.prisma`. ูุฐุง ูุดูุฑ ุฅูู ุฃู ุงูููุฏ ูุฏูู ุฃู ุบูุฑ ูุชูุงูู ูุน ุงูู schema ุงูุญุงูู ุฃู ูุฏ ูููู ููุงู ุฌุฏูู `profiles` ูุฏูู ูู Supabase.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุนุฑุถ ููุญุฉ ุชุญูู ุฅุฏุงุฑูุฉ ูุงุถุญุฉ ูุน ุฅุญุตุงุฆูุงุช ุตุญุฉ ุงููุธุงู.
    *   ุชูููุฑ ูุธููุฉ "Run Health Check" ุงูุชู ุชุฌูุจ ุญุงูุฉ ุงูุฎุฏูุงุช ุงููุฎุชููุฉ.
    *   ุงูุชุนุงูู ูุน ุงูุชุฑุฌูุฉ ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุฌูุฏ.

### `consol.zip/consol/src/app/[locale]/ai-assistant/page.tsx`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 112**: ุงุณุชุฎุฏุงู `fetch('/api/ai-assistant/save-conversation', ...)` ุจุนุฏ ูู ุฑุณุงูุฉ. ูููู ุฃู ูุคุฏู ูุฐุง ุฅูู ุงุณุชุฏุนุงุกุงุช API ุฒุงุฆุฏุฉ ุฅุฐุง ูุงู ุงูุชุฏูู (streaming) ูุญุฏุซ ุจุดูู ูุณุชูุฑ. ูููู ุชุญุณูู ุฐูู ูุชุฌููุน ุงูุฑุณุงุฆู ูุญูุธูุง ุจุดูู ุฏูุฑูุ ุฃู ุนูุฏ ุงูุชูุงุก ุงููุญุงุฏุซุฉุ ุฃู ุนูุฏูุง ูุบุงุฏุฑ ุงููุณุชุฎุฏู.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุชูููุฐ ูุงุฌูุฉ ูุณุชุฎุฏู ูุณุงุนุฏ ุฐูุงุก ุงุตุทูุงุนู ุชูุงุนููุฉ ูุน ุฏุนู ุงูุชุฏูู ูุชุญุฏูุฏ ุงูุฃูุถุงุน.
    *   ุงุณุชุฎุฏุงู `useRef` ู `scrollToView` ูุชูุฑูุฑ ูุงูุฐุฉ ุงูุฏุฑุฏุดุฉ ุชููุงุฆูุงู.
    *   ุงูุชุนุงูู ูุน ุงูุชุฑุฌูุฉ ููุฑุณุงุฆู ูุงูุฅุฌุฑุงุกุงุช ุงูุณุฑูุนุฉ.

### `consol.zip/consol/src/app/api/inbox/route.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 125**: `accessToken: userInstagramAccount.accessToken` ุชูุณุชุฎุฏู ูุจุงุดุฑุฉ. ูุฐุง ุงูู Token ููุฎุฒูู ูุดูุฑุงูุ ููุฌุจ ุฅูุบุงุก ุชุดููุฑู ูุจู ุงูุงุณุชุฎุฏุงู (ุงูุธุฑ "ุงููุดุงูู" ู "ุงูุฎุทูุงุช ุงูุชุงููุฉ" ูู ุงูุฃุนูู).
*   **ุงูุชุญุณููุงุช**:
    *   **ุณุทุฑ 20-30ุ 33-43**: ุงูุงุณุชุนูุงู ุนู ุฑุณุงุฆู Instagram ู WhatsApp ูููู ุชุญุณููู ููุดูู ุฌููุน ุญุณุงุจุงุช ุงููุณุชุฎุฏู ุงููุดุทุฉ ุจุฏูุงู ูู ุงูุงุนุชูุงุฏ ุนูู `userId || 'unknown'` ููุท.
    *   **ุณุทุฑ 54**: `messages: combinedMessages` ูุฏ ููุฑุฌุน ุญูููุงู ุญุณุงุณุฉ (ูุซู `accessToken` ุฅุฐุง ุชู ุชุถููููุง ุนู ุทุฑูู ุงูุฎุทุฃ) ุฃู ุญููู Prisma ุฏุงุฎู ูุงุฆู `lead`/`campaign`. ูุฌุจ ุชุตููุฉ ุญููู ุงูุงุณุชุฌุงุจุฉ ูุถูุงู ุฅุฑุณุงู ุงูุจูุงูุงุช ุงูุถุฑูุฑูุฉ ููุท ููุนููู.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ููุทุฉ ููุงูุฉ ููุญุฏุฉ ูุฌูุจ ูุฅุฑุณุงู ุฑุณุงุฆู Instagram ู WhatsApp.
    *   ุงุณุชุฎุฏุงู `requireAuth` ูุถูุงู ุงููุตุงุฏูุฉ.

### `consol.zip/consol/src/app/api/leads/route.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 61**: `createAdminClient()` ุชูุณุชุฎุฏู ููุชุญูู ูู ููููุฉ ุงูุญููุฉุ ุจูููุง `requireAuth` ุชูุณุชุฎุฏู ูููุตุงุฏูุฉ ุงูุฑุฆูุณูุฉ. ุงูุงุชุณุงู ูู ุงุณุชุฎุฏุงู ุทุจูุงุช ุงููุตุงุฏูุฉ/ุงูุชุฎููู ูููู ุฃู ููุญุณู.
    *   **ุณุทุฑ 66**: `!auth.email?.includes('admin')` ููุชุญูู ูู ุตูุงุญูุงุช ุงููุณุคูู. ูุฌุจ ุงุณุชุฎุฏุงู ุงูุฏูุฑ ุงููุฎุฒู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุซู `auth.role === 'admin'`).
    *   **ุณุทุฑ 127**: `createAdminClient()` ุชูุณุชุฎุฏู ูุฌูุจ Leadsุ ุจูููุง `requireAuth` ูููุตุงุฏูุฉ. ุงูุงุชุณุงู ูู ุงุณุชุฎุฏุงู ุทุจูุงุช ุงููุตุงุฏูุฉ/ุงูุชุฎููู ูููู ุฃู ููุญุณู.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุฎูุงุฑุฒููุฉ ุฐููุฉ ูุญุณุงุจ ููุงุท Leads (`calculateLeadScore`) ุชูุนุฏ ุฅุถุงูุฉ ูููุฉ.
    *   ุชุถููู `auth.userId` ูุชุนููู Leads ูุฑุจุทูู ุจุงููุณุชุฎุฏู ุงูุฐู ุฃูุดุฃูู ูุนุฒุฒ ุงูุฃูุงู ูุฅุฏุงุฑุฉ ุงูุจูุงูุงุช.
    *   ููุชุฑุฉ Leads ุญุณุจ `assignedTo` ูู `GET` ุชุถูู ุฃู ุงููุณุชุฎุฏู ูุฑู Leads ุงูุฎุงุตุฉ ุจู ููุท.

### `consol.zip/consol/src/app/api/ai-auto-replies/route.ts`
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ููุทุฉ ููุงูุฉ API ุดุงููุฉ ูู CRUD ุนูู ููุงุนุฏ ุงูุฑุฏ ุงูุชููุงุฆู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู.
    *   ุงุณุชุฎุฏุงู `requireAuth` ูุถูุงู ุงููุตุงุฏูุฉ ูุงูุชุญูู ูู ููููุฉ ุงูููุงุนุฏ ูุจู ุงูุชุนุฏูู ุฃู ุงูุญุฐู ูุนุฒุฒ ุงูุฃูุงู.
    *   ุชุญุฏูุฏ ุฃููุงุน ุงูุจูุงูุงุช ุจูุถูุญ (ูุซู `AutoReplyRule`).

### `consol.zip/consol/src/app/api/voice/route.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 53**: `// Note: userId and campaign fields need to be added to Call model in schema`. ูุฐุง ูุดูุฑ ุฅูู ููุต ูู ุงูู schema ุงูุญุงูู ูุฌุจ ูุนุงูุฌุชู ูุฅููุงู ุงูุจูุงูุงุช.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุชูุงูู ZadarmaClient ูุฅุฌุฑุงุก ุงูููุงููุงุช.
    *   ุชุฎุฒูู ุณุฌูุงุช ุงูููุงููุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุชุญุฏูุซ ุงูุญุงูุฉ.
    *   ูุญุต ููููุฉ Leads ูุจู ุฅุฌุฑุงุก ุงูููุงููุงุช ูุนุฒุฒ ุงูุฃูุงู.

### `consol.zip/consol/src/app/api/campaigns/route.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 13**: `allowAnonymous: true` ูู `requireAuth`. ูุฏ ูููู ูุฐุง ุบูุฑ ููุตูุฏ ูู Campaigns APIุ ุญูุซ ูุฌุจ ุนุงุฏุฉู ุญูุงูุฉ ุจูุงูุงุช ุงูุญููุงุช. ุฅุฐุง ูุงู ูุฐุง ููุตูุฏุงูุ ููุถุญ ุงูุณูุงู.
    *   **ุณุทุฑ 71**: `!auth.email?.includes('admin')` ูุชุฑุฎูุต ุงูุชุญุฏูุซ. ูุฌุจ ุงุณุชุจุฏุงููุง ุจูุญุต ุฏูุฑ ููุงุณุจ (ูุซู `auth.role === 'admin'`).
    *   **ุณุทุฑ 115**: ููุณ ูุดููุฉ ุชุฑุฎูุต ุงูุญุฐู ุจุงุณุชุฎุฏุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ููุงุท ููุงูุฉ API ููู CRUD ุนูู ุงูุญููุงุช ูุน ุงููุตุงุฏูุฉ ูุชุชุจุน ููุดุฆ ุงูุญููุฉ.
    *   ุฏุนู ุงูุชุตููุฉ ูุงูุชูุณูู (pagination) ููุญููุงุช.

### `consol.zip/consol/src/app/api/campaigns-manager/route.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 32ุ 65ุ 109**: ุฅูุดุงุก ูุซูู `new PrismaClient()` ุจุฏูุงู ูู ุงุณุชูุฑุงุฏ ุงูู singleton ูู `src/lib/db.ts` (ุงูุธุฑ ุงููุดููุฉ 3).
    *   **ุณุทุฑ 39**: `description: '', // AdCampaign model doesn't have description field`. ูุดูุฑ ุฅูู ุนุฏู ุงุชุณุงู ุจูู ูููุฐุฌ ุงูุจูุงูุงุช ูุงููุชุทูุจุงุช.
*   **ุงูุชุญุณููุงุช**:
    *   **ุณุทุฑ 39**: ูุฌุจ ุชุญุฏูุซ Prisma schema ูุฅุถุงูุฉ ุญูู ุงููุตู ุฅุฐุง ูุงู ูุทููุจุงู.

### `consol.zip/consol/src/app/api/ai-agent/route.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 6-17**: Persona (`IMPERIUM_AI_PERSONA`) ุชุชุถูู ูุนูููุงุช ูุญุฏุฏุฉ ููุดุงุฑูุน hardcoded. ูุฐุง ูููู ูู ูุฑููุฉ ุงูุชูููู (ุงูุธุฑ ุงููุดููุฉ 7).
    *   **ุณุทุฑ 111**: `prisma.call.create` ูุง ุชูุญุฏุฏ `userId` ุฃู `campaignId`ุ ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ูุฏ ุชู ุชุญุฏูุฏู ูู `// TODO` ูู ููู `voice/route.ts`ุ ููู ูุง ูุดูุฑ ุฅูู ุถุฑูุฑุฉ ุชุญุฏูุซ ุงูู schema.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ุชูุฏูู persona ุบููุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ.
    *   ููุทุฉ ููุงูุฉ ูุชุนุฏุฏุฉ ุงูุงุณุชุฎุฏุงูุงุช ููุฐูุงุก ุงูุงุตุทูุงุนู ุชุชุนุงูู ูุน ุงูุฏุฑุฏุดุฉ ูุงูููุงููุงุช ูุชุญููู ุงูุณูู ูุฅุฏุงุฑุฉ Leads.

### `consol.zip/consol/src/app/api/campaigns-manager/ai-suggestions/route.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 40-97**: ูุนูุฏ ุชูููุฐ ููุทู ุงูุชุจุฏูู ุจูู ูููุฑู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจุฏูุงู ูู ุงุณุชุฏุนุงุก `generateText` ูู `src/lib/ai/provider.ts` (ุงูุธุฑ ุงููุดููุฉ 6).
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ูุญุงููุฉ ุชูุฏูู ุงูุชุฑุงุญุงุช ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุญููุงุช.

### `consol.zip/consol/src/app/api/webhooks/meta/route.ts`
*   **ุงููุดุงูู**:
    *   **ุณุทุฑ 26**: ุงุณุชุฎุฏุงู `imperiumgate_meta_verify_2024` ูููุฉ ุซุงุจุชุฉ. ูุฌุจ ุงุณุชุฎุฏุงู `env.META_WEBHOOK_VERIFY_TOKEN`.
    *   **ุณุทุฑ 98**: `@ts-ignore` ูู `message.message.is_echo`. ูุฌุจ ุชุญุฏูุซ Type definitions ูุงุณุชูุนุงุจ ุฌููุน ุงูุญููู ุงููุญุชููุฉ ูู ุญูููุฉ ุงูู webhook.
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ูุนุงูุฌ Webhook ููุญุฏ ููุฑูุฒู ูู Metaุ ูุฏุนู Instagram ู WhatsApp.
    *   ุงูุชุญูู ูู ุชูููุน ุงูู Webhook ูุนุฒุฒ ุงูุฃูุงู.
    *   ููุทู ุงูุฑุฏ ุงูุชููุงุฆู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุน ุชุฎุฒูู ุงูุฑุณุงุฆู.

### `consol.zip/consol/src/app/api/integrations/instagram/callback/route.ts`
*   **ุฃูุถู ุงูููุงุฑุณุงุช**:
    *   ูุนุงูุฌ ุชุฏูู OAuth2 ุจุดูู ุตุญูุญ (ุชุจุงุฏู ุงูุฑููุฒ ุงููุตูุฑุฉ ูุงูุทูููุฉุ ุฌูุจ ุชูุงุตูู ุงูุตูุญุฉ ูุญุณุงุจ Instagram Business).
    *   ูุณุชุฎุฏู `encrypt(accessToken)` ูุจู ุงูุชุฎุฒูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

### `consol.zip/consol/src/app/api/webhooks/instagram/messages/route.ts`
*   **ุงููุดุงูู**:
    *   **ุงุฒุฏูุงุฌูุฉ ูุจูุฑุฉ**: ูุฐุง ุงูููู ููุฑุฑ ุฃู ูุฏูู ุฌุฏุงู ููุงุฑูุฉ ุจู `src/app/api/webhooks/meta/route.ts`. ูุญุชูู ุนูู ููุณ ููุทู ุงูุชุญูู ูุงูุชุนุงูู ูุน ุงูุฑุณุงุฆู. **ูุฐุง ูุฌุจ ุฅุฒุงูุชู ุชูุงูุงู ุฃู ุฏูุฌู**.
    *   **ุณุทุฑ 130**: `supabase.from('Campaign').select('id').eq('externalId', referral.ad_id).single();` - ูุฐุง ูุดูุฑ ุฅูู ุฃู ุฌุฏูู Campaign ููุณุชุฎุฏูุ ูููู ุงูู schema ุงูุญุงูู ูุฏ ูููู ูุฏูู `InstagramCampaign`. ูุฌุจ ุงูุชุฃูุฏ ูู ุงูุงุชุณุงู.
    *   **ุณุทุฑ 138-141**: ููุทู ุงูุชุญูู ูู `existingLead` ูุนุชูุฏ ุนูู `source: 'INSTAGRAM_DM'` ู `email.eq.${sender.username}` ุฃู `phone.eq.${sender.username}`. `sender.username` ููุณ ุจุงูุถุฑูุฑุฉ ุนููุงู ุจุฑูุฏ ุฅููุชุฑููู ุฃู ุฑูู ูุงุชูุ ููุฏ ูุง ูููู ูุฑูุฏุงู.
*   **ุงูุชุญุณููุงุช**:
    *   ุฅุฐุง ุชูุฑุฑ ุงูุงุญุชูุงุธ ุจูุณุงุฑุงุช webhook ูููุตูุฉ ููู ููุตุฉ (ููู ุฃูุฑ ูุง ูููุตุญ ุจู ูู Meta ูุฃููุง ุชููุฑ ูุงุฌูุฉ ููุญุฏุฉ)ุ ููุฌุจ ุฅุนุงุฏุฉ ุจูุงุก ูุฐุง ุงููุณุงุฑ ุจุงููุงูู ูุงุณุชุฎุฏุงู ููุณ ุงูุฃุฏูุงุช ูุงูููุฌ ุงููุทุจู ูู `meta/route.ts`ุ ุจูุง ูู ุฐูู AI auto-replies.

## ุณุฌู ุงููุญุงุฏุซุฉ

### ๐ฌ ุงููุณุชุฎุฏู

ูุง ุงุฑูุฏ ููู ุงูุงู ูู ุงู ุชุนูู ุงู ุงูู ุดูุก ุชุถุน ุงูููุงุท ุงูุญุฑุฌู ุงูุชู ูุฌุจ ูุนุงูุฌุชูุง ูุจุงุดุฑู ุงุซููู ูุถุน ุฎุทู ุนูู ูู ูุฑุจุท ุงููุงุนุฏู ุงูุจูุงูุงุช ุจุงูุดูู ุงูุตุญูุญ ุจุญูุซ ุงู ูุนูู ูู ุดูุก ุงุญุชุงุฌ ุฎูุงู ูุตู ุณุงุนู ุงู ุงุฑูุน ุงููุดุฑูุน ุนูู ููุฑุณูู ููุฌุจ ุงู ูุฏุฎููุง ููููู ุงูุณุนุฑ ุงู ูุนูู ููููู ุงููุงููุงุช ุงูุชุญูู ุจูุง ูู ูุนูู ุจุงูุงููุฑ ุงูุชู ุชุนูู ุงู ุงู ุงูุงููุฑ ุงูููุฌูุฏู ูุงูุชู ุณูู ุฑุจุทูุง ุจุดูู ูุจุงุดุฑ ูุฌุจ ุงูุนูู ุนูููุง ูุจุงุดุฑู ุชุตุญูุญูุง ุญุชู ูุฑูุนูุง ุงูุงููุฑ ุงูุชู ุชุญุชุงุฌ ููุช ุจุงููุงููุง ูุถุนูุง ุญุงููุง ุฌุงูุจุง ุญุชู ูุฑูุน ูุง ูุฏููุง ุงุณุชุทูุน ุงู ุงุฑุณู ุฑุงุจุท ููู ุงู ูุณุชุทูุน ุงูุดุฎุต ุงูุงุฎุฑ ุงู ุงููุณุชุฎุฏู ุงูุฏุฎูู ูู ุฎูุงู ููุฒุฑ ูููู ุจุงุณูุฑุฏ ููุณุชุทูุน ุงู ูุชุญูู ุจุญุณุงุจู ูู ูุงุญูู ูุถูู ููููุต ูู ูู ูุฐู ุงูุงููุฑ ูุจุงุณุฑุน ููุช ูููู ูุงุนุทูู ุงูุถู ุทุฑููู ูุงูุถู ุงุณููุจ ููููุงู ุจุฐูู ุงุณุชูุงุฏุง ุงูู ูุง ุงุฑุณูุชู ูู ูููุงุช

---

### ๐ฌ ุงููุณุงุนุฏ

ุชูุงูุ ุจูุงุกู ุนูู ุงููููุงุช ุงูุชู ูุฏูุชูุง ูุงูููุช ุงููุญุฏูุฏ ูุฏูู (ูุตู ุณุงุนุฉ ููุฑูุน ุนูู Vercel)ุ ุณุฃูุฏู ูู ุฎุทุฉ ุนูู ููุซูุฉ ููุฑูุฒุฉ ุนูู ุงูููุงุท ุงูุฃูุซุฑ ุญุฑุฌูุง ูุถูุงู ุงูุญุฏ ุงูุฃุฏ ุงูุฃุฏูู ูู ุงูููุชุฌ ุงููุงุจู ููุชุดุบูู (MVP) ูุน ุงูุชุฑููุฒ ุนูู ุชุณุฌูู ุงูุฏุฎูู ููุธุงุฆู ุฅุฏุงุฑุฉ ุงูุนููุงุก (CRM) ุงูุฃุณุงุณูุฉ ูุฏูุฌ Instagram.

---

### **ุฃููุงู: ุงูููุงุท ุงูุญุฑุฌุฉ ุงูุชู ูุฌุจ ูุนุงูุฌุชูุง ูุจุงุดุฑุฉ (ุงูุฃููููุงุช ุงููุตูู)**

1.  **ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Supabase & Prisma):**
    *   **ุงููุดููุฉ:** ุจุฏูู ุงุชุตุงู ุตุญูุญ ุจูุงุนุฏุฉ ุงูุจูุงูุงุชุ ูู ูุนูู ุฃู ุฌุฒุก ูู ุงูุชุทุจูู. ูููุงุช ูุซู `src/lib/supabase.ts` ู `src/lib/db.ts` ู `src/app/[locale]/login/page.tsx` ุชุนุชูุฏ ุนูููุง.
    *   **ุงูุฅุฌุฑุงุก ุงูููุฑู:**
        *   **ุชุฃููุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ:** ุงูุชุญ ููู `.env.local` ูุชุฃูุฏ ูู ุฃู ุฌููุน ุงููุชุบูุฑุงุช ุงููุชุนููุฉ ุจู Supabase (ูุซู `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`) ููุชุบูุฑ `DATABASE_URL` (ูู Prisma) ูุฏ ุชู ุฅุฏุฎุงููุง ุจุดูู ุตุญูุญ ูุชุทุงุจู ุจูุงูุงุช ูุดุฑูุนู ุนูู Supabase.
        *   **ุชุทุจูู ูุฎุทุท Prisma:** ูู ุณุทุฑ ุงูุฃูุงูุฑ (Terminal) ุฏุงุฎู ูุฌูุฏ ุงููุดุฑูุนุ ูู ุจุชุดุบูู `npm run db:push` (ุฃู `npx prisma db push`). ูุฐุง ูุถูู ุฃู ุจููุฉ ุฌุฏุงูู ูุงุนุฏุฉ ุจูุงูุงุชู ุนูู Supabase ุชุชุทุงุจู ูุน ููู `prisma/schema.prisma` ูู ูุดุฑูุนู.
        *   **ุงุฎุชุจุงุฑ ุงูุงุชุตุงู:** ุงุณุชุฎุฏู `npm run db:check` ููุชุฃูุฏ ูู ุฃู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุนูู.

2.  **ุงููุตุงุฏูุฉ ูุชุณุฌูู ุงูุฏุฎูู (Authentication):**
    *   **ุงููุดููุฉ:** ูุฌุจ ุฃู ูุชููู ุงููุณุชุฎุฏู ูู ุชุณุฌูู ุงูุฏุฎูู ูููุตูู ุฅูู ุฃู ููุฒุงุช ูุญููุฉ.
    *   **ุงูุฅุฌุฑุงุก ุงูููุฑู:**
        *   **ุฅูุดุงุก ูุณุชุฎุฏู ุชุฌุฑูุจู:** ูู ุจุฅูุดุงุก ูุณุชุฎุฏู ูุงุญุฏ ุนูู ุงูุฃูู ูู ููุญุฉ ุชุญูู Supabase (Authentication -> Users) ุจุงุณุชุฎุฏุงู ุจุฑูุฏ ุฅููุชุฑููู ููููุฉ ูุฑูุฑ.
        *   **ุงุฎุชุจุงุฑ ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู:** ุดุบู ุงููุดุฑูุน ูุญูููุง (`npm run dev`) ูุงูุชูู ุฅูู `http://localhost:3000/en/login` (ุฃู `/ar/login`). ุญุงูู ุชุณุฌูู ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุชุฌุฑูุจู. ูุฌุจ ุฃู ุชุชููู ูู ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุชุญูู.

3.  **ูุธุงุฆู CRM ุงูุฃุณุงุณูุฉ (ุฅุถุงูุฉ/ุนุฑุถ ุงูุนููุงุก ุงููุญุชูููู):**
    *   **ุงููุดููุฉ:** ูุฐู ูู ุฌููุฑ "ุงูุชุญูู ูู ุงูุฃููุฑ ุงูุชู ุชุนูู".
    *   **ุงูุฅุฌุฑุงุก ุงูููุฑู:**
        *   **ุนุฑุถ ุงูุนููุงุก ุงููุญุชูููู:** ุจุนุฏ ุชุณุฌูู ุงูุฏุฎููุ ุงูุชูู ุฅูู `/en/crm`. ุชุฃูุฏ ูู ุฃู ุงููุงุฌูุฉ ุชุธูุฑ (ุณูุงุก ููุญุฉ Kanban ุฃู ูุงุฆูุฉ Leads) ุฏูู ุฃุฎุทุงุกุ ุญุชู ูู ูุงูุช ูุงุฑุบุฉ.
        *   **ุฅุถุงูุฉ ุนููู ูุญุชูู:** ุงุณุชุฎุฏู ุฒุฑ "Add Lead" ูุฃุฏุฎู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ. ุชุฃูุฏ ูู ุฃู ุงูุนููู ุงููุญุชูู ูุธูุฑ ูู ุงููุงุฌูุฉ ุจุนุฏ ุงูุฅุถุงูุฉ. (ูุฐุง ูุนุชูุฏ ุนูู `src/actions/crm.ts` ู `src/components/crm/add-lead-dialog.tsx`).

4.  **ุฏูุฌ Instagram ุงูุฃุณุงุณู (ูุดุฑ ุงูููุดูุฑุงุช):**
    *   **ุงููุดููุฉ:** ุฅุฏุงุฑุฉ ุงููุญุชูู ุนูู Instagram ููุฒุฉ ุฃุณุงุณูุฉ ูู ุงููุดุฑูุน.
    *   **ุงูุฅุฌุฑุงุก ุงูููุฑู:**
        *   **ูุชุบูุฑุงุช ุจูุฆุฉ Meta:** ุชุฃูุฏ ูู ุฃู `META_APP_ID`, `META_APP_SECRET`, `NEXT_PUBLIC_META_REDIRECT_URI`, ู `META_USER_ACCESS_TOKEN` (ูููุตูู ุฅูู ุญุณุงุจ Instagram ุงูุชุฌุงุฑู) ููุฌูุฏุฉ ูุตุญูุญุฉ ูู `.env.local`.
        *   **ุงุฎุชุจุงุฑ ุฅูุดุงุก ููุดูุฑ:** ุงูุชูู ุฅูู `/en/instagram/content-manager`. ุญุงูู ุฑูุน ุตูุฑุฉ ุฃู ููุฏูู ููุชุงุจุฉ ุชุนููู. ุซู ุงุณุชุฎุฏู ุฒุฑ "Publish Now" (ุงููุดุฑ ุงูุขู). ุฑุงูุจ ุงูู Terminal ูุฃู ุฃุฎุทุงุก ุชุชุนูู ุจุงุชุตุงู Meta API. ูุฏููุง ูู ุงูุชุฃูุฏ ูู ุฃู ุนูููุฉ ุงูุฑูุน ูุงูุงุชุตุงู ุงูุฃุณุงุณูุฉ ุชุนูู.

---

### **ุซุงููุงู: ุฎุทุฉ ุงูุนูู ุงูุชูุตูููุฉ ูุฑุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุดุบูู ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ (ูู 30 ุฏูููุฉ)**

**ุงูุฎุทูุงุช ุงููุชุจุนุฉ ุงูุขู:**

1.  **ุถุจุท ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ (5 ุฏูุงุฆู):**
    *   ุงูุชุญ ููู `consol.zip/consol/.env.local`.
    *   ุงูุตู ุจูุงูุงุช ูุดุฑูุนู Supabase:
        ```
        NEXT_PUBLIC_SUPABASE_URL="https://your-project-id.supabase.co"
        NEXT_PUBLIC_SUPABASE_ANON_KEY="your-anon-public-key"
        SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"
        DATABASE_URL="postgresql://postgres:[YOUR_PASSWORD]@db.your-project-id.supabase.co:5432/postgres" # ุฃู connection pooler URI
        ```
    *   ุงูุตู ุจูุงูุงุช Meta ุงูุฎุงุตุฉ ุจู (ูู Meta Developers App):
        ```
        META_APP_ID="your-meta-app-id"
        META_APP_SECRET="your-meta-app-secret"
        NEXT_PUBLIC_META_REDIRECT_URI="https://your-vercel-app-url.vercel.app/api/integrations/instagram/callback" # ุฃู http://localhost:3000/api/integrations/instagram/callback ูุญูููุง
        META_USER_ACCESS_TOKEN="your-user-access-token-for-instagram-business-account" # ุชููู ุทููู ุงูุฃูุฏ
        META_WEBHOOK_VERIFY_TOKEN="imperiumgate_meta_verify_2024" # ูุฌุจ ุฃู ูุทุงุจู ูุฐุง ูู ุฅุนุฏุงุฏุงุช Meta Webhook
        ```
    *   **ููุงุญุธุฉ:** ุฅุฐุง ููุช ูุง ุชููู `META_USER_ACCESS_TOKEN` ุจุนุฏุ ูุณูุคุฏู ุฐูู ุฅูู ูุดู ููุฒุงุช Instagram. ููููู ุชุฑูู ูุงุฑุบูุง ููุฑูุน ุงูุณุฑูุนุ ูููู ุชูุนูู ุงูููุฒุฉ ูุชุทูุจ ุฅุนุฏุงุฏู.

2.  **ูุฒุงููุฉ ูุฎุทุท Prisma (2 ุฏูููุฉ):**
    *   ุงูุชุญ Terminal ุฌุฏูุฏ ูู ูุฌูุฏ `consol.zip/consol`.
    *   ููุฐ ุงูุฃูุฑ: `npm run db:push`
    *   ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก. ุฅุฐุง ูุงุฌูุช ูุดุงููุ ูุฏ ุชุญุชุงุฌ ุฅูู ุญุฐู ูุฌูุฏ `node_modules` ูููู `package-lock.json` ุซู ุชุดุบูู `npm install` ูุฑุฉ ุฃุฎุฑู ูุจู `db:push`.

3.  **ุฅูุดุงุก ูุณุชุฎุฏู ุชุฌุฑูุจู (3 ุฏูุงุฆู):**
    *   ุงูุชูู ุฅูู ููุญุฉ ุชุญูู Supabase ููุดุฑูุนู.
    *   ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ `Authentication`ุ ุซู `Users`.
    *   ุงููุฑ ุนูู ุฒุฑ `Invite` ุฃู `Add user` ูุฃูุดุฆ ูุณุชุฎุฏููุง ุฌุฏูุฏูุง (ุนูู ุณุจูู ุงููุซุงู: `test@example.com` ููููุฉ ูุฑูุฑ `password123`).
    *   **ููุงุญุธุฉ:** ูููู ุถุจุท ุงูุฃุฏูุงุฑ ููุง ุฃูุถูุงุ ูููู ููุชุฌุฑุจุฉ ุงูุฃูููุฉุ ูููู ูุณุชุฎุฏู ุนุงุฏู.

4.  **ุงุฎุชุจุงุฑ ูุญูู ูููุธุงุฆู ุงูุฃุณุงุณูุฉ (10 ุฏูุงุฆู):**
    *   ูู Terminalุ ุดุบู: `npm run dev`
    *   ุงูุชุญ ุงููุชุตูุญ ูุงูุชูู ุฅูู `http://localhost:3000/en/login`.
    *   **ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู:** ุณุฌู ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู ุงููุณุชุฎุฏู ุงูุชุฌุฑูุจู ุงูุฐู ุฃูุดุฃุชู.
        *   **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ูุฌุจ ุฃู ูุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ ูุฅุนุงุฏุฉ ุชูุฌููู ุฅูู `/en/dashboard`.
    *   **ุงุฎุชุจุงุฑ CRM:**
        *   ุงูุชูู ุฅูู `/en/crm`. ูุฌุจ ุฃู ุชุธูุฑ ูุงุฌูุฉ Kanban/List.
        *   ุงููุฑ ุนูู ุฒุฑ `Add Lead`. ุงููุฃ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (ุงูุงุณูุ ุงููุงุชู) ูุญูุธ.
        *   **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ูุฌุจ ุฃู ูุธูุฑ ุงูุนููู ุงููุญุชูู ุงูุฌุฏูุฏ ูู ููุญุฉ CRM.
    *   **ุงุฎุชุจุงุฑ Instagram Content Manager (ุงูุญุฏ ุงูุฃุฏูู):**
        *   ุงูุชูู ุฅูู `/en/instagram/content-manager`.
        *   ุญุงูู ุฑูุน ุฃู ุตูุฑุฉ ุตุบูุฑุฉ ูุงูุชุจ ุชุนููููุง (Caption).
        *   ุงููุฑ ุนูู ุฒุฑ `Publish Now`.
        *   **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ูุฌุจ ุฃูุง ุชุฑู ุฃุฎุทุงุก ุญุฑุฌุฉ ูู ุงููุชุตูุญ ุฃู Terminal. ุฅุฐุง ุชู ุงูุฅุนุฏุงุฏ ุจุดูู ุตุญูุญุ ููุฏ ูุชู ูุดุฑ ุงูููุดูุฑ ุจุงููุนู.

5.  **ุงูุชุญุถูุฑ ูุงููุดุฑ ุนูู Vercel (5 ุฏูุงุฆู):**
    *   **ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุนูู Vercel:**
        *   ูุจู ุงููุดุฑ ุนูู Vercelุ ูุฌุจ ุฃู ุชุถูู ุฌููุน ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูู ููู `.env.local` (ุงูุชู ููุช ุจุถุจุทูุง ูู ุงูุฎุทูุฉ 1) ุฅูู ุฅุนุฏุงุฏุงุช ูุดุฑูุนู ูู Vercel.
        *   ุงูุชูู ุฅูู ููุญุฉ ุชุญูู Vercel ููุดุฑูุนู -> `Settings` -> `Environment Variables`.
        *   ุฃุถู ูู ูุชุบูุฑ ุจูุฆู ููุงู ุจููุณ ุงูุงุณู ูุงููููุฉ.
        *   **ูุชุบูุฑุงุช `NEXT_PUBLIC_`:** ูุฌุจ ุฃู ุชุจุฏุฃ ุจู `NEXT_PUBLIC_` ููู ุชููู ูุชุงุญุฉ ูู ุจูุฆุฉ ุงููุชุตูุญ.
        *   **ูุชุบูุฑุงุช ุณุฑูุฉ:** ุชุฃูุฏ ูู ุฃู `SUPABASE_SERVICE_ROLE_KEY` ู `META_APP_SECRET` ู `META_USER_ACCESS_TOKEN` ุชู ูุถุน ุนูุงูุฉ ุนูููุง ูู `Secret` ูู Vercel.
    *   **ุงููุดุฑ:** ุจูุฌุฑุฏ ูุฒุงููุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉุ ูู ุจูุดุฑ ูุดุฑูุนู ุนูู Vercel.

**ุงูุฃููุฑ ุงูุชู ูููู ุชุฃุฌูููุง ูููุฑุญูุฉ ุงูุซุงููุฉ (ุจุนุฏ ุงููุดุฑ):**

*   **ููุฒุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุชูุฏูุฉ (AI Suggestions):** ูุซู ุชูู ุงูููุฌูุฏุฉ ูู ุตูุญุงุช `Ad Creator` ุฃู `Campaigns Manager`. ูููู ููุฐู ุงูููุฒุงุช ุฃู ุชุนูู ุจุจูุงูุงุช ุงูุชุฑุงุถูุฉ ุฃู ุชูุนุทู ูุคูุชูุง ุฅุฐุง ูุงู ุฅุนุฏุงุฏ ููุงุชูุญ API ุงูุฎุงุตุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู (OpenRouter, Gemini, ZAI) ูุณุชุบุฑู ููุชูุง.
*   **ุฏูุฌ Zadarma (Voice):** ูููู ุชุฑูู ูุงุญููุง ุฅุฐุง ูุงูุช ุงูููุงููุงุช ุงููุงุชููุฉ ููุณุช ุฌุฒุกูุง ุญุงุณููุง ูู ุงูู MVP.
*   **ููุญุฉ ุชุญูููุงุช ูุงููุฉ:** ูููู ุนุฑุถ ุจูุงูุงุช ููููุฉ ุฃู ูุจุณุทุฉ ูู `/en/analytics` ูุญูู ุชูุนูู ุฌูุน ุงูุจูุงูุงุช ุงููุงูู.
*   **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุฃุฏูุงุฑ ุงููุชูุฏูุฉ ูู ุตูุญุฉ Admin:** ุฑูุฒ ุนูู ุฃู ูููู ููุงู ูุณุชุฎุฏู ูุงุญุฏ ุนูู ุงูุฃูู ูุนูู.
*   **ุงูุชูุทูู ุงููุงูู (Internationalization) ููู ุงููุตูุต:** ุฑูุฒ ุนูู ุงููุณุงุฑุงุช ุงูุฑุฆูุณูุฉ.

ูุฐู ุงูุฎุทุฉ ุชุฑูุฒ ุนูู ุชูุนูู ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ ุจุฃูุตู ุณุฑุนุฉ ููููุฉ. ุจุงูุชูููู ูู ุงููุดุฑ!

---

